<!DOCTYPE html>
<html lang="en">

<head>
 <meta charset="utf-8">
 <title>Ticketfly API</title>
</head>

<body>
   
     
<div class="iframe"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://apis.google.com/js/api.js"></script>
<script src="https://cdn.jsdelivr.net/momentjs/2.12.0/moment.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){
    // Example queryURL for Ticketfly
    // var queryURL = "http://www.ticketfly.com/api/events/upcoming.json?orgId=1&q=Philadelphia&maxResults=30&fieldGroup=light";
    let artist = "";
    let i, topTrack = "";
    $.ajax({
        url: `http://www.ticketfly.com/api/events/upcoming.json?orgId=1&q=Bloomington&maxResults=10&fieldGroup=light&fields=id,startDate,venue.name,venue.address1`,
        method: "GET",
        dataType: 'jsonp',
        cors: true,
        secure: true,
                headers: {
                    'Access-Control-Allow-Origin': '*',
                },
    }).then(function(response) {
        console.log(response);
        for (i in response.events){
            // console.log(response.events[0].name);
        
        artist = response.events[i].name
        // console.log(artist);
        $.ajax({
        url: `http://ws.audioscrobbler.com/2.0/?method=artist.gettoptracks&artist=${artist}&api_key=6a82a8e13684dddbc3db96ec8d600e51&format=json`,
        method: "GET",
        //  dataType: 'jsonp',
        //  cors: true,
        //  secure: true,
        //            headers: {
        //                'Access-Control-Allow-Origin': '*',
        //            },
        
    }).then(function(response) {
        console.log(response);
        artistName=response.toptracks.track[0].artist.name
            topTrackName=response.toptracks.track[0].name
            topTrack= topTrackName + " " + "by" + " " + artistName;
            // console.log(topTrack);
        $.get(
        "https://www.googleapis.com/youtube/v3/search",{
        part:"snippet, id",
        q:topTrack,
        type: "video",
        order:"viewCount",
        key:"AIzaSyBM2Gtqqb7pp3P5e9tPNfH-eIfmNlMTR5o"},
        function(data){
            console.log(data);
            let videoId = data.items[1].id.videoId;
            // console.log(data.items);
            let iframe =`<iframe width="560" height="315" src="https://www.youtube.com/embed/${videoId}"
             frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>`
            $(".iframe").append(iframe);
        }
        // https://www.youtube.com/watch?v=VyR7yoDBQSg
  );
    });
}
    });

    // Example queryURL for Ticketfly
    // http://ws.audioscrobbler.com/2.0/

    // let artist = "beyonce";
    // console.log(artist);
    // $.ajax({
    //     url: `http://ws.audioscrobbler.com/2.0/?method=artist.gettoptracks&artist=${artist}&api_key=6a82a8e13684dddbc3db96ec8d600e51&format=json`,
    //     method: "GET",
    //     //  dataType: 'jsonp',
    //     //  cors: true,
    //     //  secure: true,
    //     //            headers: {
    //     //                'Access-Control-Allow-Origin': '*',
    //     //            },
    // }).then(function(response) {
    //     console.log(response);
        
    // });

//   $.get(
//     "https://www.googleapis.com/youtube/v3/search",{
//         part:"snippet, id",
//         q:"halo beyonce",
//         type: "video",
//         order:"viewCount",
//         key:"AIzaSyBM2Gtqqb7pp3P5e9tPNfH-eIfmNlMTR5o"},
//         function(data){
//             let videoId = data.items[1].id.videoId;
//             console.log(data.items);
//             let iframe =`<h2><a href="https://www.youtube.com/watch?v=${videoId}">Click here to watch video</a></h2>`
//             $(".iframe").append(iframe);
//         }
//         // https://www.youtube.com/watch?v=VyR7yoDBQSg
//   );
    // $(function(){
    //     // $("form").on("submit", function(e){
    //     //     e.preventDefault();
            
    //         // prepare the request
    //         var request = gapi.client.youtube.search.list({
    //             part:"snippet",
    //             type:"video",
    //             q:encodeURIComponent("halo beyonce").replace(/%20/g, "+"),
    //             maxResult: "viewCount"
    //         });
    //         //execute the request
    //         request.execute(function(response){
    //             console.log(reponse);
    //         });
    //     // });

    // });


});
 </script>

</body>

</html>